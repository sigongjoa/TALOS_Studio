# 계획: vtracer를 이용한 이미지 벡터화

## 1. 개요

본 문서는 흑백의 라인 아트(Line Art) 이미지를 `vtracer` 라이브러리를 사용하여 SVG 벡터 데이터로 변환하는 프로세스의 구현 및 배포 계획을 정의합니다.

최종 목표는 `vtracer`가 생성한 벡터 결과물을 시각적으로 확인할 수 있는 웹페이지를 배포하는 것입니다.

---

## 2. 구현 방식: `vtracer` 라이브러리 활용

복잡한 벡터화 알고리즘을 직접 구현하는 대신, 검증된 오픈소스 라이브러리인 `vtracer`의 Python 바인딩을 사용합니다. 이를 통해 전체 파이프라인을 아래와 같이 간소화합니다.

### 1단계: 경로 탐색 (Path Decomposition)

*   **목표:** 스켈레톤 이미지에서 선들의 외곽선을 따라가며, 여러 개의 닫힌 경로(폴리곤)와 그 포함 관계(계층)를 찾아냅니다.
*   **방법:** Python의 **OpenCV** 라이브러리에 있는 `cv2.findContours` 함수를 `cv2.RETR_TREE` 모드로 사용합니다.
*   **결과물:** 각 경로(폴리곤)를 나타내는 (x, y) 점들의 목록과, 각 경로의 부모-자식 관계를 나타내는 `hierarchy` 배열.

### 2단계: 폴리곤 최적화 (Polygon Optimization)

*   **목표:** 1단계의 폴리곤에서 불필요한 점들을 제거하고, 곡선의 시작/끝점이 될 코너(corner)를 탐지합니다.
*   **방법:**
    1.  **단순화:** **Ramer-Douglas-Peucker** 알고리즘을 적용하여 폴리곤을 구성하는 점의 개수를 줄입니다.
    2.  **코너 탐지:** 단순화된 폴리곤에서 각도가 급격하게 꺾이는 '코너' 지점들을 찾아냅니다.
*   **결과물:** 코너점들로만 구성된, 최적화된 폴리곤.

### 3단계: 곡선 피팅 (Curve Fitting)

*   **목표:** 2단계에서 찾아낸 각 코너 사이의 점들을 가장 잘 표현하는 부드러운 베지어 곡선을 찾아냅니다.
*   **방법:** **Philip J. Schneider의 곡선 피팅 알고리즘**을 구현하여, 원본 점들을 오차가 가장 적게 통과하는 최적의 베지어 곡선을 반복적으로 계산합니다.
*   **결과물:** 4개의 제어점(시작점, 제어점1, 제어점2, 끝점)으로 정의되는 베지어 곡선들의 목록.

### 4단계: SVG 변환 (SVG Output)

*   **목표:** 3단계에서 계산된 베지어 곡선들을 실제 이미지 파일로 만들어 눈으로 확인합니다.
*   **방법:** 계산된 베지어 곡선 목록을 읽어, 웹브라우저에서 쉽게 볼 수 있는 **SVG(Scalable Vector Graphics) 파일**로 변환하는 스크립트를 작성합니다.
*   **결과물:** 벡터화된 최종 라인 아트가 담긴 `.svg` 파일.

---

## 3. `vtracer` 상세 파라미터

`vtracer`의 Python 함수는 SVG 변환 시 아래와 같은 다양한 파라미터를 조절하는 기능을 제공합니다. 추후 `run_standalone_vectorizer.py` 스크립트에 이 파라미터들을 커맨드 라인 인자로 추가하여, 결과물의 품질을 세밀하게 튜닝할 수 있습니다.

*   `corner_threshold`: 코너를 얼마나 날카롭게 감지할지 (값이 클수록 둥글게 처리)
*   `length_threshold`: 얼마나 긴 경로를 유의미한 선으로 볼 것인지
*   `filter_speckle`: 지정된 크기보다 작은 노이즈(반점)를 얼마나 제거할지
*   `max_iterations`: 곡선 피팅의 정확도를 높이기 위해 얼마나 많이 반복 계산할지
*   `splice_threshold`: 여러 곡선 경로를 얼마나 부드럽게 연결할지
*   `path_precision`: SVG 경로의 소수점 이하 정밀도

### `index.html` 페이지 구성

`output_visualizations` 폴더 안에 생성되는 `index.html` 페이지를 아래와 같은 4개의 열(Column)을 가진 표 형태로 구성하여 각 단계별 결과물을 비교합니다.

| 1. 원본 스켈레톤 (입력) | 2. 계층 시각화 (1단계) | 3. 폴리곤 최적화 결과 (2단계) | 4. 최종 SVG 결과 (4단계) |
| :---: | :---: | :---: | :---: |
| `skeleton.png` | `hierarchy.png` | `polygons.png` | `vectorized_output.svg` |

*   1, 2, 3단계의 결과물은 OpenCV를 통해 이미지 파일(.png)로 생성하여 표시합니다.
*   **계층 시각화**에서는 바깥쪽 윤곽선(부모)은 녹색, 안쪽 윤곽선(자식/구멍)은 빨간색으로 표시하여 포함 관계를 시각적으로 나타냅니다.
*   4단계의 최종 결과물은 SVG 파일 자체를 웹페이지에 삽입하여, 확대/축소를 통해 부드러운 곡선을 상세히 확인할 수 있도록 합니다.


---

## 4. 현재 상태

*   `vtracer` 라이브러리를 사용하는 파이프라인 구현이 완료되었습니다.
*   `run_standalone_vectorizer.py`를 실행하여 결과물을 생성하고, `git push`를 통해 배포할 수 있습니다.